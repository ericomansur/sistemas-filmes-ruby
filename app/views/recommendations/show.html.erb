<div class="max-w-6xl mx-auto">
  <!-- Back Button -->
  <div class="mb-6">
    <%= link_to recommendations_path, class: "text-indigo-400 hover:text-indigo-300 font-medium inline-flex items-center" do %>
      <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
      </svg>
      Voltar para Recomenda√ß√µes
    <% end %>
  </div>

  <% if @movie_details %>
    <!-- Movie Header -->
    <div class="bg-gray-800 rounded-lg overflow-hidden border border-gray-700 mb-8">
      <div class="md:flex">
        <!-- Poster -->
        <div class="md:flex-shrink-0 md:w-1/3">
          <% if @movie_details['poster_path'] %>
            <%= image_tag TmdbService.poster_url(@movie_details['poster_path'], 'w780'), 
                         alt: @movie_details['title'], 
                         class: "w-full h-full object-cover" %>
          <% else %>
            <div class="w-full h-96 bg-gray-700 flex items-center justify-center">
              <span class="text-8xl">üé¨</span>
            </div>
          <% end %>
        </div>

        <!-- Details -->
        <div class="p-8 md:w-2/3">
          <h1 class="text-4xl font-bold text-white mb-4">
            <%= @movie_details['title'] %>
          </h1>

          <% if @movie_details['tagline'].present? %>
            <p class="text-xl text-gray-400 italic mb-4">
              "<%= @movie_details['tagline'] %>"
            </p>
          <% end %>

          <!-- Stats -->
          <div class="flex flex-wrap gap-4 mb-6">
            <div class="flex items-center space-x-2">
              <span class="text-yellow-400 text-2xl">‚≠ê</span>
              <span class="text-white text-xl font-bold"><%= @movie_details['vote_average']&.round(1) || "N/A" %></span>
              <span class="text-gray-400 text-sm">(<%= @movie_details['vote_count'] %> votos)</span>
            </div>

            <% if @movie_details['release_date'].present? %>
              <div class="flex items-center space-x-2">
                <span class="text-2xl">üìÖ</span>
                <span class="text-white"><%= Date.parse(@movie_details['release_date']).year %></span>
              </div>
            <% end %>

            <% if @movie_details['runtime'].present? %>
              <div class="flex items-center space-x-2">
                <span class="text-2xl">‚è±Ô∏è</span>
                <span class="text-white"><%= @movie_details['runtime'] %> min</span>
              </div>
            <% end %>
          </div>

          <!-- Genres -->
          <% if @movie_details['genres'].present? %>
            <div class="mb-6">
              <h3 class="text-white font-semibold mb-2">G√™neros:</h3>
              <div class="flex flex-wrap gap-2">
                <% @movie_details['genres'].each do |genre| %>
                  <span class="bg-indigo-600 text-white px-3 py-1 rounded-full text-sm">
                    <%= genre['name'] %>
                  </span>
                <% end %>
              </div>
            </div>
          <% end %>

          <!-- Overview -->
          <% if @movie_details['overview'].present? %>
            <div class="mb-6">
              <h3 class="text-white font-semibold mb-2 text-lg">Sinopse:</h3>
              <p class="text-gray-300 leading-relaxed">
                <%= @movie_details['overview'] %>
              </p>
            </div>
          <% end %>

          <!-- Actions -->
          <div class="flex flex-wrap gap-3">
            <% unless @recommendation.watched? %>
              <%= button_to mark_watched_recommendation_path(@recommendation), 
                           method: :patch,
                           form: { data: { turbo: false } },
                           class: "bg-green-600 hover:bg-green-700 text-white font-semibold py-2 px-6 rounded-lg transition" do %>
                ‚úì Marcar como Assistido
              <% end %>
            <% else %>
              <span class="bg-green-700 text-white font-semibold py-2 px-6 rounded-lg">
                ‚úì J√° Assistido
              </span>
            <% end %>

            <%= button_to watch_laters_path(tmdb_id: @recommendation.tmdb_id),
                         method: :post,
                         form: { data: { turbo: false } },
                         class: "bg-yellow-600 hover:bg-yellow-700 text-white font-semibold py-2 px-6 rounded-lg transition" do %>
              ‚è∞ Assistir Mais Tarde
            <% end %>

            <%= link_to "https://www.themoviedb.org/movie/#{@recommendation.tmdb_id}", 
                       target: "_blank",
                       class: "bg-gray-700 hover:bg-gray-600 text-white font-semibold py-2 px-6 rounded-lg transition inline-flex items-center" do %>
              üîó Ver no TMDB
            <% end %>

            <%= button_to recommendation_path(@recommendation), 
                         method: :delete,
                         form: { data: { turbo: false, turbo_confirm: "Remover esta recomenda√ß√£o?" } },
                         class: "bg-red-700 hover:bg-red-600 text-white font-semibold py-2 px-6 rounded-lg transition" do %>
              üóëÔ∏è Remover
            <% end %>
          </div>
        </div>
      </div>
    </div>

    <!-- Similar Movies -->
    <% if @similar_movies&.any? %>
      <div class="mb-8">
        <h2 class="text-2xl font-bold text-white mb-4">üé≠ Filmes Similares</h2>
        
        <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4">
          <% @similar_movies.first(12).each do |movie| %>
            <div class="group relative">
              <div class="bg-gray-800 rounded-lg overflow-hidden border border-gray-700 hover:border-indigo-500 transition transform hover:scale-105 cursor-pointer">
                <% if movie['poster_path'] %>
                  <%= image_tag TmdbService.poster_url(movie['poster_path']), 
                               alt: movie['title'], 
                               class: "w-full h-64 object-cover" %>
                <% else %>
                  <div class="w-full h-64 bg-gray-700 flex items-center justify-center">
                    <span class="text-4xl">üé¨</span>
                  </div>
                <% end %>
                
                <div class="p-3">
                  <h3 class="text-white font-medium text-sm truncate group-hover:text-indigo-400 transition">
                    <%= movie['title'] %>
                  </h3>
                  <div class="flex items-center mt-1">
                    <span class="text-yellow-400 text-xs">‚≠ê</span>
                    <span class="text-gray-400 text-xs ml-1"><%= movie['vote_average']&.round(1) || "N/A" %></span>
                  </div>
                </div>
              </div>
              
              <!-- Hover Actions -->
              <div class="absolute inset-0 bg-black bg-opacity-75 opacity-0 group-hover:opacity-100 transition-opacity flex flex-col items-center justify-center p-4 rounded-lg">
                <h4 class="text-white font-semibold text-center mb-3 line-clamp-2"><%= movie['title'] %></h4>
                
                <%= button_to watch_laters_path(tmdb_id: movie['id']),
                             method: :post,
                             form: { data: { turbo: false } },
                             class: "bg-indigo-600 hover:bg-indigo-700 text-white text-xs font-semibold py-2 px-4 rounded-lg transition w-full mb-2" do %>
                  ‚è∞ Adicionar √† Lista
                <% end %>
                
                <%= link_to "https://www.themoviedb.org/movie/#{movie['id']}", 
                           target: "_blank",
                           class: "bg-gray-700 hover:bg-gray-600 text-white text-xs font-semibold py-2 px-4 rounded-lg transition w-full text-center" do %>
                  üëÅÔ∏è Ver Detalhes
                <% end %>
              </div>
            </div>
          <% end %>
        </div>
      </div>
    <% end %>

  <% else %>
    <!-- Error State -->
    <div class="bg-red-900 border border-red-700 rounded-lg p-8 text-center">
      <div class="text-6xl mb-4">‚ö†Ô∏è</div>
      <h2 class="text-2xl font-bold text-white mb-2">Erro ao carregar detalhes</h2>
      <p class="text-red-200 mb-4">
        N√£o foi poss√≠vel carregar as informa√ß√µes deste filme.
      </p>
      <%= link_to recommendations_path, class: "inline-block bg-red-700 hover:bg-red-600 text-white font-semibold py-2 px-4 rounded-lg transition" do %>
        Voltar para Recomenda√ß√µes
      <% end %>
    </div>
  <% end %>
</div>